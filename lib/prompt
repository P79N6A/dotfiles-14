#!/bin/bash

function prompt_update() {
  local is_dirty='';
  local branch='';
  local status='';

  if [[ `git symbolic-ref HEAD 2> /dev/null` && `git rev-parse --short HEAD 2> /dev/null` ]]; then
    branch=`git symbolic-ref HEAD 2> /dev/null | grep -e '[^\/]*'$ -io`;

    local flags='--porcelain --ignore-submodules=dirty --untracked-files=no';
    if [[ `git status ${flags} 2> /dev/null | tail -n1` ]]; then
      is_dirty=1;
    fi
  fi

  local user="\u";
  local host=" at \h";
  local dir=" in [\w]";
  local ps1="$ ";
  local ps2="-> ";

  PS1="${user}${host}${dir}${is_dirty}${branch}${status}";
  PS1+="\n";
  PS1+="${ps1}";
  export PS1;

  PS2="${ps2}";
  export PS2;
}

export PROMPT_COMMAND="history -a; prompt_update";
