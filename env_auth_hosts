#!/bin/bash


cat ~/.ssh/id_rsa.pub | ssh ydmm@ydmm.net "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"


ssh_copy_id_github() {

  echo "Authorizing github"


  if [ -z $1 ]; then
    echo "What is your github username?"
    read githubusername
  else
    githubusername=$1
  fi

  mkdir -p ~/tmp
  curl -s https://api.github.com/authorizations --user $githubusername --data "{\"scopes\":[\"write:public_key\"],\"note\":\"ssh-copy-id-github, user: $USER host: $HOST time: `date` \"}" > ~/tmp/github_token_response

  token=`cat ~/tmp/github_token_response | grep "token" | cut -d ':' -f2 | tr -d "\"" | tr -d ", " | tr -d " "`

  rm -rf ~/tmp/github_token_response

  key=`cat ~/.ssh/id_rsa.pub`

  result=$(curl -s https://api.github.com/user/keys -X POST -H "Authorization: token $token" -H "application/json" -d "{\"title\": \"autobot@localhost\", \"key\": \"$key\"}")

  echo "$result"

}

ssh_copy_id_github deshawnbw
